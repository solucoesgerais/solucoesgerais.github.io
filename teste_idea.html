<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Organic Liquid Fill</title>
    <style>
        :root { --bg-chroma: #00ff00; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--bg-chroma); overflow: hidden; font-family: sans-serif; }

        /* MENU */
        #ui-layer { position: fixed; inset: 0; z-index: 100; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.9); color: white; }
        .panel { background: #111; padding: 30px; border-radius: 20px; width: 340px; border: 1px solid #333; }
        .control-group { margin-bottom: 15px; }
        .label-row { display: flex; justify-content: space-between; margin-bottom: 5px; }
        label { font-size: 11px; color: #888; text-transform: uppercase; }
        .val-display { font-size: 12px; color: #00ffdd; font-weight: bold; }
        input[type=range] { width: 100%; accent-color: #00ffdd; cursor: pointer; }
        input[type=color] { width: 100%; height: 45px; border: none; cursor: pointer; background: none; }
        button { width: 100%; padding: 18px; margin-top: 20px; border: none; border-radius: 12px; background: #00ffdd; color: #000; font-weight: 900; cursor: pointer; text-transform: uppercase; }
        
        #countdown { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: 90; font-size: 15rem; color: white; font-weight: 900; }

        /* STAGE */
        #stage { position: fixed; inset: 0; filter: url(#liquid-goo); }
        .blob { position: absolute; border-radius: 50%; will-change: transform; transform: scale(0); }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div class="panel">
            <h2>Liquid Setup</h2>
            <div class="control-group">
                <div class="label-row"><label>Agitação (Speed)</label><span class="val-display" id="v-speed">1.0</span></div>
                <input type="range" id="speed" min="0.2" max="3.0" step="0.1" value="1.0">
            </div>
            <div class="control-group">
                <div class="label-row"><label>Densidade</label><span class="val-display" id="v-density">60</span></div>
                <input type="range" id="density" min="20" max="150" value="60">
            </div>
            <div class="control-group">
                <div class="label-row"><label>Timer (s)</label><span class="val-display" id="v-delay">3</span></div>
                <input type="range" id="delay" min="0" max="10" step="1" value="3">
            </div>
            <label>Cor</label>
            <input type="color" id="color" value="#ffffff">
            <button id="start-btn">Gerar Versão Orgânica</button>
        </div>
    </div>

    <div id="countdown"></div>
    <div id="stage"></div>

    <svg style="display: none;">
        <defs>
            <filter id="liquid-goo">
                <feGaussianBlur in="SourceGraphic" stdDeviation="30" result="blur" />
                <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 50 -20" />
            </filter>
        </defs>
    </svg>

    <script>
        let blobs = [];
        let isRunning = false;

        const setupInp = (id) => {
            const inp = document.getElementById(id);
            const dsp = document.getElementById('v-'+id);
            inp.oninput = () => dsp.innerText = inp.value;
        };
        ['speed', 'density', 'delay'].forEach(setupInp);

        document.getElementById('start-btn').onclick = () => {
            const config = {
                speed: parseFloat(document.getElementById('speed').value),
                density: parseInt(document.getElementById('density').value),
                delay: parseInt(document.getElementById('delay').value),
                color: document.getElementById('color').value
            };
            document.getElementById('ui-layer').style.display = 'none';

            if (config.delay > 0) {
                const cd = document.getElementById('countdown');
                cd.style.display = 'flex';
                let count = config.delay;
                cd.innerText = count;
                const timer = setInterval(() => {
                    count--; cd.innerText = count;
                    if (count <= 0) { clearInterval(timer); cd.style.display = 'none'; initLiquid(config); }
                }, 1000);
            } else { initLiquid(config); }
        };

        function initLiquid(config) {
            const stage = document.getElementById('stage');
            const w = window.innerWidth;
            const h = window.innerHeight;

            for (let i = 0; i < config.density; i++) {
                const bEl = document.createElement('div');
                bEl.className = 'blob';
                const size = Math.random() * 350 + 250; 
                bEl.style.width = size + 'px';
                bEl.style.height = size + 'px';
                bEl.style.background = config.color;

                blobs.push({
                    el: bEl,
                    x: Math.random() * w,
                    y: Math.random() * h,
                    size: size,
                    scale: 0,
                    maxScale: 2.5 + (Math.random() * 1.5),
                    delay: Math.random() * 1500, 
                    growth: 0.003 + (config.speed * 0.004),
                    seedX: Math.random() * 100,
                    seedY: Math.random() * 100,
                    speedX: (0.001 + Math.random() * 0.002) * config.speed,
                    speedY: (0.001 + Math.random() * 0.002) * config.speed,
                    // Deformação única por blob
                    stretchX: 0.8 + Math.random() * 0.4,
                    stretchY: 0.8 + Math.random() * 0.4
                });
                stage.appendChild(bEl);
            }
            isRunning = true;
            requestAnimationFrame(animate);
        }

        function animate(now) {
            if (!isRunning) return;
            blobs.forEach(b => {
                if (!b.startTime) b.startTime = now;
                const elapsed = now - b.startTime;

                if (elapsed > b.delay && b.scale < b.maxScale) {
                    b.scale += b.growth;
                }

                // Lógica de movimento inspirada no seu código (Eixos separados)
                const moveX = Math.sin(now * b.speedX + b.seedX) * 60;
                const moveY = Math.cos(now * b.speedY + b.seedY) * 60;

                // DEFORMAÇÃO ORGÂNICA:
                // Criamos um pulso de "estica e puxa" constante
                const pulseX = 1 + Math.sin(now * 0.002 + b.seedX) * 0.15;
                const pulseY = 1 + Math.cos(now * 0.002 + b.seedY) * 0.15;

                const tx = b.x - (b.size / 2) + moveX;
                const ty = b.y - (b.size / 2) + moveY;

                // Aplicamos a escala geral multiplicada pelo pulso de deformação
                b.el.style.transform = `
                    translate(${tx}px, ${ty}px) 
                    scale(${b.scale * pulseX}, ${b.scale * pulseY})
                `;
            });
            requestAnimationFrame(animate);
        }
    </script>
</body>
</html>